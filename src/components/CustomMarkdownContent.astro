---
// 必须导入默认的MarkdownContent组件
import Default from '@astrojs/starlight/components/MarkdownContent.astro';

// 导入博客相关组件
import { getBlogEntry } from 'starlight-blog/libs/content';
import { isAnyBlogPostPage } from 'starlight-blog/libs/page';
import Cover from 'starlight-blog/components/Cover.astro';
import Metadata from 'starlight-blog/components/Metadata.astro';
import PostTags from 'starlight-blog/components/PostTags.astro';
import PrevNextLinks from 'starlight-blog/components/PrevNextLinks.astro';

// 导入图片缩放组件
import ImageZoom from 'starlight-image-zoom/components/ImageZoom.astro';

const { id, locale } = Astro.locals.starlightRoute;

// 只在博客文章页面获取文章数据
let entry, nextLink, prevLink;
if (isAnyBlogPostPage(id)) {
  const blogData = await getBlogEntry(id, locale);
  entry = blogData.entry;
  nextLink = blogData.nextLink;
  prevLink = blogData.prevLink;
}
---

<!-- 无论什么页面，都添加图片缩放功能 -->
<ImageZoom />

<!-- 使用默认的MarkdownContent，但添加博客特定功能 -->
<Default>
  {isAnyBlogPostPage(id) && entry.data.cover && <Cover cover={entry.data.cover} />}
  {isAnyBlogPostPage(id) && <Metadata entry={entry} locale={locale} showBadges={false} />}
  <slot />
  {isAnyBlogPostPage(id) && (
    <div class="post-footer">
      <PostTags entry={entry} locale={locale} />
      <PrevNextLinks next={nextLink} prev={prevLink} />
    </div>
  )}
</Default>

{isAnyBlogPostPage(id) && (
  <style>
    .post-footer {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      margin-block-start: 2rem !important;
    }
  </style>
)} 
