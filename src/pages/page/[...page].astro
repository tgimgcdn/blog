---
import { getCollection } from 'astro:content';
import HomePage from '../../components/HomePage.astro';

export async function getStaticPaths() {
  // 获取所有博客文章
  const allPosts = await getCollection('docs', entry => entry.id.startsWith('blog/'));
  const postsPerPage = 9; // 每页显示9篇文章
  const totalPages = Math.ceil(allPosts.length / postsPerPage);
  
  console.log(`[...page].astro: 总文章数=${allPosts.length}, 总页数=${totalPages}`);
  
  // 生成所有分页的路径
  const paths = [];
  
  // 第一页对应 /page/ 路径
  paths.push({
    params: { page: undefined },
    props: { pageNum: 1, totalPages }
  });
  
  // 其他页面的路径 /page/2/, /page/3/ 等
  for (let i = 2; i <= totalPages; i++) {
    paths.push({
      params: { page: String(i) },
      props: { pageNum: i, totalPages }
    });
  }
  
  return paths;
}

const { pageNum } = Astro.props;
---

<HomePage pageNum={pageNum} /> 
