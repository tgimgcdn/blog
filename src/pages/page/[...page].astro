---
// 导入公开的组件
import { getCollection } from 'astro:content';
import HomePage from '../../components/HomePage.astro';

export async function getStaticPaths() {
  // 使用标准Astro方法获取所有博客文章
  let allPosts = [];
  let totalPages = 0;
  
  try {
    // 获取所有博客文章（与博客插件使用相同的路径模式）
    allPosts = await getCollection('docs', entry => entry.id.startsWith('blog/'));
    const totalArticles = allPosts.length;
    const postsPerPage = 9; // 每页9篇文章
    totalPages = Math.ceil(totalArticles / postsPerPage);
    
    console.log(`[...page].astro: 总文章数=${totalArticles}, 总页数=${totalPages}`);
  } catch (error) {
    console.error("获取博客文章失败:", error);
    // 如果无法获取，默认生成2页
    totalPages = 2;
  }
  
  // 为所有页面生成路径
  const paths = [];
  
  // 首页重定向 - 这会创建 /page/ 路径
  paths.push({
    params: { page: undefined },
    props: { pageNum: 1 }
  });
  
  // 后续页面: /page/2/, /page/3/ 等
  for (let i = 2; i <= totalPages; i++) {
    paths.push({
      params: { page: String(i) },
      props: { pageNum: i }
    });
  }
  
  return paths;
}

// 从路由参数获取页码
const { pageNum } = Astro.props;

// 为了调试目的记录当前页码
console.log(`[...page].astro: 渲染页面 ${pageNum}`);
---

<HomePage pageNum={pageNum} /> 
